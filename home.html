<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teste Online Presencial - HyperClass</title>

  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body, html {
      height: 100%;
      background: #0b0c10;
    }
    .instructions {
      min-height: 100vh;
      display: grid;
      place-items: center;
      color: #eaeef2;
      padding: 2rem;
      text-align: center;
    }
    .timer-badge {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .form-wrap {
      padding-top: 4.25rem; /* espaço para navbar fixa */
    }
    /* iframe ocupa a altura visível menos a navbar */
    #formFrame {
      width: 100%;
      height: calc(100vh - 4.25rem);
      border: none;
      background: #111217;
      display: block;
      margin: 0 auto;
      max-width: 900px; /* limita largura em telas muito grandes */
    }
  </style>
</head>
<body>

  <!-- Navbar fixa com cronômetro (aparece após começar) -->
  <nav id="topbar" class="navbar navbar-dark bg-dark fixed-top d-none">
    <div class="container-fluid justify-content-center">
      <span class="navbar-text text-light">
        Tempo restante:
        <span id="timer" class="badge bg-warning text-dark timer-badge">02:00:00</span>
      </span>
    </div>
  </nav>

  <!-- Bloco de instruções + botão -->
  <section id="intro" class="instructions">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <h1 class="mb-3">Instruções para realização do teste</h1>
          <div class="text-start bg-dark p-4 rounded-3 border border-secondary">
            <ol class="mb-0">
              <li>Ao clicar em <strong>Começar</strong>, o teste entrará em tela cheia e o cronômetro de <strong>2 horas</strong> será iniciado.</li>
              <li>Não feche a aba durante a execução do teste. O tempo continuará contando.</li>
              <li>Responda a todas as questões no formulário exibido.</li>
              <li>Ao término do tempo, finalize e envie suas respostas.</li>
            </ol>
          </div>
          <div class="d-grid mt-4">
            <button id="startBtn" class="btn btn-primary btn-lg">
              Começar
            </button>
          </div>
          <p class="text-secondary mt-3 mb-0">
            Dica: mantenha sua conexão estável durante todo o teste.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contêiner do formulário (inicia oculto) -->
  <main id="exam" class="form-wrap d-none">
    <div class="container-fluid">
      <iframe
        id="formFrame"
        src="https://docs.google.com/forms/d/e/1FAIpQLSckVn12oUJo-kuoow3bE-E8zeZ03zUVUaN2QziQUweHwPnwlg/viewform?embedded=true"
        allowfullscreen
      >
        Carregando…
      </iframe>
    </div>
  </main>

  <!-- Bootstrap JS (opcional, para componentes) -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    (function () {
      const startBtn = document.getElementById('startBtn');
      const intro = document.getElementById('intro');
      const exam = document.getElementById('exam');
      const topbar = document.getElementById('topbar');
      const timerEl = document.getElementById('timer');
      let ticking = false;
      let intervalId = null;
      const DURATION_MS = 2 * 60 * 60 * 1000; // 2h

      function pad(n) { return String(n).padStart(2, '0'); }

      function formatTime(msLeft) {
        const totalSec = Math.max(0, Math.floor(msLeft / 1000));
        const h = Math.floor(totalSec / 3600);
        const m = Math.floor((totalSec % 3600) / 60);
        const s = totalSec % 60;
        return `${pad(h)}:${pad(m)}:${pad(s)}`;
      }

      function startTimer() {
        const endAt = Date.now() + DURATION_MS;
        timerEl.textContent = formatTime(DURATION_MS);

        intervalId = setInterval(() => {
          const left = endAt - Date.now();
          timerEl.textContent = formatTime(left);

          // aviso visual no fim
          if (left <= 5 * 60 * 1000 && !timerEl.classList.contains('bg-danger')) {
            // últimos 5 min
            timerEl.classList.remove('bg-warning', 'text-dark');
            timerEl.classList.add('bg-danger', 'text-light');
          }

          if (left <= 0) {
            clearInterval(intervalId);
            timerEl.textContent = '00:00:00';
            // Feedback final (não fecha o formulário automaticamente)
            alert('Tempo encerrado! Envie suas respostas agora.');
          }
        }, 1000);
      }

      async function goFullscreen() {
        const el = document.documentElement;
        try {
          if (el.requestFullscreen) await el.requestFullscreen();
          else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
          else if (el.msRequestFullscreen) await el.msRequestFullscreen();
        } catch (e) {
          // Se falhar (bloqueio do navegador), seguimos sem fullscreen
          console.warn('Não foi possível ativar tela cheia:', e);
        }
      }

      startBtn.addEventListener('click', async () => {
        if (ticking) return; // evita múltiplos cliques
        ticking = true;

        await goFullscreen();          // tenta entrar em tela cheia
        startTimer();                  // inicia cronômetro
        topbar.classList.remove('d-none');

        // Alterna para o formulário
        intro.classList.add('d-none');
        exam.classList.remove('d-none');

        // rola ao topo para garantir que o formulário esteja visível
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Ajusta a altura do iframe ao redimensionar (mantém a tela "cheia")
      function adjustIframeHeight() {
        const navH = document.querySelector('.navbar.fixed-top')?.offsetHeight || 0;
        const frame = document.getElementById('formFrame');
        frame.style.height = `calc(100vh - ${navH}px)`;
      }
      window.addEventListener('resize', adjustIframeHeight);
      window.addEventListener('load', adjustIframeHeight);
    })();
  </script>
</body>
</html>
